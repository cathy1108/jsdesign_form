<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>捷士設計 | 預約裝修諮詢</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fdfbf7; color: #4a4a4a; overflow-x: hidden; }
        .animate-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .home-bg {
            background-image: linear-gradient(rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4)), url('https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?auto=format&fit=crop&q=80&w=1200');
            background-size: cover;
            background-position: center;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .btn-warm {
            background: linear-gradient(135deg, #d4a373 0%, #a98467 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-warm:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -10px rgba(169, 132, 103, 0.6);
        }
        /* 顯眼的控制按鈕 */
        .nav-arrow {
            width: 44px;
            height: 44px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #f1efed;
            color: #a98467;
            transition: all 0.3s ease;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 30;
        }
        .nav-arrow:hover {
            background: #a98467;
            color: white;
            transform: translateY(-50%) scale(1.1);
        }
        .nav-arrow.left { left: -12px; }
        .nav-arrow.right { right: -12px; }

        @keyframes bounce-x {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(4px); }
        }
        .animate-bounce-x { animation: bounce-x 1.5s infinite; }
        
        /* 數線流程樣式 */
        .flow-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 0 10px;
        }
        .flow-line {
            position: absolute;
            top: 15px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #f1efed;
            z-index: 0;
        }
        .flow-line-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #d4a373;
            transition: width 0.4s ease;
        }
        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
            cursor: pointer;
            width: 60px;
        }
        .flow-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            border: 2px solid #f1efed;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: bold;
            color: #d1d5db;
        }
        .flow-step.active .flow-dot {
            border-color: #a98467;
            background: #a98467;
            color: white;
            box-shadow: 0 0 0 4px rgba(169, 132, 103, 0.15);
            transform: scale(1.1);
        }
        .flow-step.completed .flow-dot {
            border-color: #d4a373;
            color: #d4a373;
        }
        
        .timeline-dot {
            width: 8px;
            height: 8px;
            background: #d4a373;
            border-radius: 50%;
            position: relative;
            z-index: 10;
        }
        .timeline-line {
            width: 2px;
            background: #f1efed;
            position: absolute;
            top: 8px;
            bottom: -24px;
            left: 3px;
        }

        .content-card {
            background: linear-gradient(to bottom right, #fdfcfb 0%, #f7f5f2 100%);
            border: 1px solid #eeebe6;
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.03);
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }

        .service-img-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            cursor: zoom-in;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .service-img-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }
        .service-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .service-img-container:hover .service-img {
            transform: scale(1.1);
        }

        .img-label {
            font-size: 10px;
            font-weight: 700;
            color: #78716c;
            text-align: center;
            margin-top: 6px;
            display: block;
        }

        /* 燈箱樣式 */
        .lightbox-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        .lightbox-content {
            max-width: 95%;
            max-height: 90vh;
            position: relative;
        }
        .lightbox-img {
            width: auto;
            max-width: 100%;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const ScriptURL = "/api/send";

        const SERVICE_IMAGES = [
            { title: "模型圖", url: "3d1.png", desc: "空間結構規劃與動線確認" },
            { title: "擬真圖 A", url: "3d2.png", desc: "材質氛圍與燈光效果模擬" },
            { title: "擬真圖 B", url: "3d3.png", desc: "細部軟裝與色彩配置參考" }
        ];

        const STYLES = [
            { id: 'scandinavian', title: '北歐簡約', img: 'https://images.unsplash.com/photo-1598928506311-c55ded91a20c?auto=format&fit=crop&q=80&w=400' },
            { id: 'modern-luxury', title: '現代輕奢', img: 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&q=80&w=400' },
            { id: 'muji', title: '無印風', img: 'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?auto=format&fit=crop&q=80&w=400' },
            { id: 'japandi', title: '侘寂禪風', img: 'https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&q=80&w=400' },
            { id: 'industrial', title: '工業復古', img: 'https://images.unsplash.com/photo-1505691723518-36a5ac3be353?auto=format&fit=crop&q=80&w=400' },
            { id: 'other', title: '其他', img: 'https://images.unsplash.com/photo-1497366754035-f200968a6e72?auto=format&fit=crop&q=80&w=400' }
        ];

        const SOURCES = [
            { id: 'ig', title: 'Instagram', icon: 'instagram' },
            { id: 'fb', title: 'Facebook', icon: 'facebook' },
            { id: 'google', title: 'Google 搜尋', icon: 'search' },
            { id: 'web', title: '官方網站', icon: 'globe' },
            { id: 'friend', title: '親友推薦', icon: 'users' },
            { id: 'other', title: '其他', icon: 'more' }
        ];

        const Icon = ({ name, className = "" }) => {
            const icons = {
                chevronRight: <polyline points="9 18 15 12 9 6"/>,
                chevronLeft: <polyline points="15 18 9 12 15 6"/>,
                instagram: <g><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></g>,
                facebook: <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>,
                search: <g><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></g>,
                globe: <g><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></g>,
                users: <g><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></g>,
                more: <g><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></g>,
                heart: <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>,
                check: <polyline points="20 6 9 17 4 12"/>,
                loader: <g><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></g>,
                close: <line x1="18" y1="6" x2="6" y2="18"></line> && <line x1="6" y1="6" x2="18" y2="18"></line>,
                x: <g><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></g>
            };
            return (
                <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    {icons[name]}
                </svg>
            );
        };

        const INITIAL_STATE = {
            name: '', phone: '', lineId: '', contactTime: '10:00-12:00',
            houseAge: '0', spaceType: '住家', serviceType: '室內設計與裝潢',
            location: '台北市', locationOther: '', caseName: '',
            isHandover: '是', handoverDate: '', size: 25, 
            budget: '100-200 萬', startDate: '', endDate: '',
            preferredStyles: [], preferredStylesOther: '', familyCount: '1',
            hasSpecialMember: [], isFutureFlex: '不需要',
            purpose: '長期自住', source: 'Instagram', sourceOther: '', note: ''
        };

        function App() {
            const [step, setStep] = useState(0);
            const [activeFlowIdx, setActiveFlowIdx] = useState(0);
            const [formData, setFormData] = useState(INITIAL_STATE);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isSuccess, setIsSuccess] = useState(false);
            const [selectedImg, setSelectedImg] = useState(null); // 用於燈箱

            const nextStep = () => setStep(s => s + 1);
            const prevStep = () => setStep(s => s - 1);
            const skipToForm = () => setStep(3);

            const isPhoneValid = formData.phone.length === 10;
            const canGoNextFromDetails = formData.name.trim() !== '' && isPhoneValid;

            const handleToggle = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: prev[field].includes(value)
                        ? prev[field].filter(v => v !== value)
                        : [...prev[field], value]
                }));
            };

            const handleSubmit = async () => {
                setIsSubmitting(true);
                const finalPreferredStyles = [...formData.preferredStyles];
                if (formData.preferredStylesOther) finalPreferredStyles.push(`其他: ${formData.preferredStylesOther}`);

                const queryParams = new URLSearchParams({
                    ...formData,
                    preferredStyles: finalPreferredStyles.join(', '),
                    hasSpecialMember: formData.hasSpecialMember.join(', '),
                    timestamp: new Date().toLocaleString()
                });

                try {
                    await fetch(`${ScriptURL}?${queryParams.toString()}`, { method: "POST", mode: "no-cors" });
                    setIsSuccess(true);
                } catch (e) {
                    alert("提交失敗，請檢查網路。");
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className={`min-h-screen flex items-center justify-center p-4 transition-all duration-1000 ${step === 0 ? 'home-bg' : 'bg-stone-50'}`}>
                    
                    {/* 圖片燈箱 */}
                    {selectedImg && (
                        <div className="lightbox-overlay" onClick={() => setSelectedImg(null)}>
                            <div className="lightbox-content animate-in" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedImg(null)} className="absolute -top-12 right-0 text-white hover:text-stone-300">
                                    <Icon name="x" className="w-8 h-8"/>
                                </button>
                                <img src={selectedImg.url} alt={selectedImg.title} className="lightbox-img" />
                                <div className="mt-4 text-center">
                                    <h4 className="text-white text-lg font-bold">{selectedImg.title}</h4>
                                    <p className="text-stone-400 text-sm mt-1">{selectedImg.desc}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className={`w-full max-w-[480px] rounded-[3rem] overflow-hidden flex flex-col min-h-[780px] shadow-2xl transition-all duration-500 ${step === 0 ? 'glass-card' : 'bg-white border border-stone-100'}`}>
                        
                        <div className="flex-1 p-8 md:p-10 flex flex-col justify-center custom-scrollbar overflow-y-auto">
                            
                            {step === 0 && (
                                <div className="text-center space-y-10 animate-in">
                                    <div className="space-y-6">
                                        <div className="w-24 h-24 rounded-full mx-auto p-1 bg-white shadow-md overflow-hidden border border-stone-100">
                                            <img src= "logo.jpg" alt="Logo" className="w-full h-full object-cover rounded-full" />
                                        </div>
                                        <div className="space-y-2">
                                            <h2 className="text-stone-400 font-medium tracking-[0.2em] text-[10px] uppercase">J.S Interior Design</h2>
                                            <h1 className="text-2xl font-bold text-stone-800">捷士設計 <span className="font-light text-stone-300 mx-1">|</span> 預約諮詢</h1>
                                        </div>
                                    </div>
                                    <div className="space-y-6 text-stone-600 leading-relaxed font-light text-sm">
                                        <p className="text-lg font-medium text-stone-700">讓我們走進您的理想生活。</p>
                                        <div className="pt-2">
                                            <a href="https://www.instagram.com/j.s.interior.design/" target="_blank" className="inline-flex items-center gap-2 px-5 py-2 rounded-full border border-stone-100 text-[11px] font-medium hover:bg-stone-50 transition-all">
                                                <Icon name="instagram" className="w-4 h-4"/> j.s.interior.design
                                            </a>
                                        </div>
                                    </div>
                                    <button onClick={nextStep} className="btn-warm w-full py-5 text-white rounded-2xl font-bold flex items-center justify-center gap-3">
                                        查看服務流程 <Icon name="chevronRight" className="w-5 h-5"/>
                                    </button>
                                </div>
                            )}

                            {step === 1 && (
                                <div className="animate-in space-y-4 flex flex-col h-full">
                                    <div className="text-center space-y-2">
                                        <h2 className="text-2xl font-bold text-stone-800">服務流程</h2>
                                        <button onClick={skipToForm} className="text-stone-400 text-xs underline underline-offset-4 decoration-stone-200 hover:text-stone-600">跳過解說，開始填寫</button>
                                    </div>
                                     <div className="px-2 pt-4 pb-4">
                                        <div className="flow-container">
                                            <div className="flow-line">
                                                <div className="flow-line-progress" style={{width: `${(activeFlowIdx / 3) * 100}%`}}></div>
                                            </div>
                                            {['丈量規劃', '設計約', '工程約', '完成'].map((label, i) => (
                                                <div key={i} className={`flow-step ${activeFlowIdx === i ? 'active' : ''} ${activeFlowIdx > i ? 'completed' : ''}`} onClick={() => setActiveFlowIdx(i)}>
                                                    <div className="flow-dot">
                                                        {activeFlowIdx > i ? <Icon name="check" className="w-4 h-4" /> : (i + 1)}
                                                    </div>
                                                    <span className={`text-[10px] mt-2 font-bold tracking-tighter ${activeFlowIdx === i ? 'text-stone-800' : 'text-stone-300'}`}>{label}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="flex-1 relative flex flex-col justify-start py-4">
                                        <button 
                                            onClick={() => setActiveFlowIdx(prev => Math.max(0, prev - 1))}
                                            className={`nav-arrow left ${activeFlowIdx === 0 ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
                                        >
                                            <Icon name="chevronLeft" className="w-6 h-6 stroke-[3px]"/>
                                        </button>
                                        <button 
                                            onClick={() => setActiveFlowIdx(prev => Math.min(3, prev + 1))}
                                            className={`nav-arrow right animate-bounce-x ${activeFlowIdx === 3 ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
                                        >
                                            <Icon name="chevronRight" className="w-6 h-6 stroke-[3px]"/>
                                        </button>

                                        <div key={activeFlowIdx} className="animate-in p-6 content-card rounded-2xl space-y-4 transition-all duration-300">
                                            <h3 className="font-bold text-stone-800 text-lg flex items-center gap-2">
                                                <span className="w-2 h-2 rounded-full bg-stone-700"></span> 
                                                {['初步規劃', '設計合約', '工程實作', '驗收交屋'][activeFlowIdx]}
                                            </h3>
                                            <div className="text-stone-500 leading-relaxed space-y-2 text-sm">
                                                {activeFlowIdx === 0 && (
                                                    <React.Fragment>
                                                        <p>● 包含現場會勘、丈量與平面圖製作。</p>
                                                        <p>● 確認需求並依圖面初步報價。</p>
                                                        <div className="mt-6 pt-5 border-t border-stone-200">
                                                            <div className="flex items-baseline justify-between">
                                                                <span className="text-stone-700 font-bold">費用：4,500 元</span>
                                                                <span className="text-[10px] text-stone-400 font-normal">後續可折抵設計或工程約</span>
                                                            </div>
                                                        </div>
                                                    </React.Fragment>
                                                )}
                                                {activeFlowIdx === 1 && (
                                                    <React.Fragment>
                                                        <p>● 繪製細部施工圖與 3D 透視圖。</p>
                                                        <p className="text-xs text-stone-400 mb-3">( 點擊圖面可放大觀看細節 )</p>
                                                        <div className="grid grid-cols-3 gap-2 mb-4">
                                                            {SERVICE_IMAGES.map((img, idx) => (
                                                                <div key={idx} onClick={() => setSelectedImg(img)}>
                                                                    <div className="service-img-container">
                                                                        <img src={img.url} alt={img.title} className="service-img" />
                                                                        <div className="absolute inset-0 bg-black/0 hover:bg-black/10 transition-all flex items-center justify-center">
                                                                            <Icon name="search" className="w-5 h-5 text-white opacity-0 hover:opacity-100 transition-opacity" />
                                                                        </div>
                                                                    </div>
                                                                    <span className="img-label">{img.title}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        <div className="space-y-2 pt-2 border-t border-stone-100">
                                                            <p className="flex justify-between items-center text-[13px]">
                                                                <span className="text-stone-600">● 施工圖與 3D 模型圖</span>
                                                                <span className="font-bold text-stone-800">2,500 / 坪</span>
                                                            </p>
                                                            <p className="flex justify-between items-center text-[13px]">
                                                                <span className="text-stone-600">● 照片級擬真效果圖</span>
                                                                <span className="font-bold text-stone-800">4,000 / 坪</span>
                                                            </p>
                                                        </div>
                                                    </React.Fragment>
                                                )}
                                                {activeFlowIdx === 2 && (
                                                    <React.Fragment>
                                                        <p>● 嚴選工班進場，嚴控品質與進度。</p>
                                                        <p>● 定期回報施作進度與照片記錄。</p>
                                                        <div className="mt-6 pt-5 border-t border-stone-200">
                                                            <div className="flex items-baseline justify-between">
                                                                <span className="text-stone-700 font-bold">監工管理費：10%</span>
                                                            </div>
                                                        </div>
                                                    </React.Fragment>
                                                )}
                                                {activeFlowIdx === 3 && (
                                                    <React.Fragment>
                                                        <p>● 完工總清收尾，現場點交驗收。</p>
                                                        <p>● 交付工程保固與保養指南。</p>
                                                        <div className="h-12 flex items-center justify-center">
                                                            <Icon name="heart" className="w-4 h-4 text-stone-200"/>
                                                        </div>
                                                    </React.Fragment>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    <button onClick={nextStep} className="btn-warm w-full py-5 text-white rounded-2xl font-bold flex items-center justify-center gap-3">
                                        下一步：收款規範 <Icon name="chevronRight" className="w-5 h-5"/>
                                    </button>
                                </div>
                            )}

                            {step === 2 && (
                                <div className="animate-in space-y-6 flex flex-col h-full">
                                    <div className="text-center space-y-2">
                                        <h2 className="text-2xl font-bold text-stone-800">收款方式</h2>
                                        <button onClick={skipToForm} className="text-stone-400 text-xs underline underline-offset-4 decoration-stone-200 hover:text-stone-600">跳過解說，開始填寫</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="bg-stone-50 border border-stone-100 p-4 rounded-2xl text-center">
                                            <p className="text-stone-400 text-[10px] uppercase mb-1 tracking-widest">新成屋</p>
                                            <p className="text-stone-700 font-bold">70 萬起</p>
                                        </div>
                                        <div className="bg-stone-50 border border-stone-100 p-4 rounded-2xl text-center">
                                            <p className="text-stone-400 text-[10px] uppercase mb-1 tracking-widest">老屋翻新</p>
                                            <p className="text-stone-700 font-bold">120 萬起</p>
                                        </div>
                                    </div>
                                    <div className="flex-1 space-y-5 relative pl-4 mt-2">
                                        {[
                                            {t: '簽約訂金', d: 'NT$ 5,000 元'},
                                            {t: '第一期 30%', d: '進場首日收取 (扣除訂金)'},
                                            {t: '第二期 30%', d: '水電拉線完畢'},
                                            {t: '第三期 30%', d: '木工退場'},
                                            {t: '第四期 10%', d: '完工驗收'}
                                        ].map((item, idx, arr) => (
                                            <div key={idx} className="flex gap-4 items-start relative">
                                                {idx < arr.length - 1 && <div className="timeline-line"></div>}
                                                <div className="timeline-dot mt-1.5"></div>
                                                <div className="space-y-0.5">
                                                    <h4 className="font-bold text-stone-800 text-sm">{item.t}</h4>
                                                    <p className="text-stone-500 text-[11px]">{item.d}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex gap-4">
                                        <button onClick={prevStep} className="p-5 rounded-2xl bg-stone-50 text-stone-300"><Icon name="chevronLeft" className="w-6 h-6"/></button>
                                        <button onClick={nextStep} className="btn-warm flex-1 py-5 text-white rounded-2xl font-bold flex items-center justify-center gap-3">
                                            開始填寫需求 <Icon name="chevronRight" className="w-5 h-5"/>
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* 此處之後的 Step 3-9 保持不變 ... */}
                            {step === 3 && (
                                <div className="animate-in space-y-6">
                                    <div className="space-y-2">
                                        <h2 className="text-2xl font-bold text-stone-800 tracking-tight">您好，該如何稱呼？</h2>
                                        <p className="text-stone-400 text-sm">請留下您的聯絡方式與方便聯絡的時間</p>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">您的姓名</label>
                                            <input type="text" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} placeholder="例如：林先生" className="w-full p-4 rounded-xl border border-stone-100 bg-stone-50 outline-none focus:bg-white focus:ring-2 focus:ring-stone-100 transition-all" />
                                        </div>
                                        <div className="space-y-1.5">
                                            <div className="flex justify-between items-center ml-1">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">聯絡電話</label>
                                                {formData.phone && !isPhoneValid && <span className="text-[10px] text-red-400 font-medium">需為 10 位數字</span>}
                                            </div>
                                            <input type="tel" maxLength="10" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value.replace(/\D/g, '')})} placeholder="例如：0912345678" className={`w-full p-4 rounded-xl border bg-stone-50 outline-none transition-all ${formData.phone && !isPhoneValid ? 'border-red-100' : 'border-stone-100'}`} />
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">LINE ID</label>
                                            <input type="text" value={formData.lineId} onChange={e => setFormData({...formData, lineId: e.target.value})} placeholder="請填寫您的 LINE ID" className="w-full p-4 rounded-xl border border-stone-100 bg-stone-50 outline-none focus:bg-white focus:ring-2 focus:ring-stone-100 transition-all" />
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">方便聯絡的時段</label>
                                            <div className="grid grid-cols-1 gap-2">
                                                {['10:00-12:00', '13:00-18:00', '18:00-21:00'].map(t => (
                                                    <button key={t} onClick={() => setFormData({...formData, contactTime: t})} className={`p-3 rounded-xl border-2 text-sm font-medium text-left px-4 transition-all ${formData.contactTime === t ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>{t}</button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {step === 4 && (
                                <div className="animate-in space-y-6">
                                    <h2 className="text-2xl font-bold text-stone-800">房屋狀況與地點</h2>
                                    <div className="space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-1.5">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">屋齡</label>
                                                <input type="number" value={formData.houseAge} onChange={e => setFormData({...formData, houseAge: e.target.value})} className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none" />
                                            </div>
                                            <div className="space-y-1.5">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">地點</label>
                                                <select value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none text-sm">
                                                    {['台北市', '新北市', '桃園', '基隆', '其他'].map(l => <option key={l} value={l}>{l}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                        {formData.location === '其他' && (
                                            <input type="text" placeholder="請填寫具體地點" value={formData.locationOther} onChange={e => setFormData({...formData, locationOther: e.target.value})} className="w-full p-3 rounded-xl border border-stone-200 text-sm outline-none" />
                                        )}
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">建案名稱 / 詳細地址</label>
                                            <input type="text" value={formData.caseName} onChange={e => setFormData({...formData, caseName: e.target.value})} placeholder="例如：捷士大樓" className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none" />
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">交屋狀態</label>
                                            <div className="flex gap-2">
                                                {['是', '否'].map(h => (
                                                    <button key={h} onClick={() => setFormData({...formData, isHandover: h})} className={`flex-1 p-3 rounded-xl border-2 text-sm font-bold ${formData.isHandover === h ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>已交屋: {h}</button>
                                                ))}
                                            </div>
                                        </div>
                                        {formData.isHandover === '否' && (
                                            <div className="space-y-1.5">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">預計交屋時間</label>
                                                <input type="date" value={formData.handoverDate} onChange={e => setFormData({...formData, handoverDate: e.target.value})} className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none" />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {step === 5 && (
                                <div className="animate-in space-y-8">
                                    <h2 className="text-2xl font-bold text-stone-800">坪數與工程預算</h2>
                                    <div className="space-y-6">
                                        <div className="text-center">
                                            <div className="mb-2"><span className="text-5xl font-black text-stone-800">{formData.size}</span><span className="text-lg text-stone-300 ml-2">坪</span></div>
                                            <input type="range" min="5" max="100" value={formData.size} onChange={e => setFormData({...formData, size: e.target.value})} className="w-full h-1.5 bg-stone-100 rounded-lg appearance-none cursor-pointer" />
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            {['100 萬以下', '100-150 萬', '150-200 萬', '200-300 萬', '300-500 萬', '500 萬以上'].map(b => (
                                                <button key={b} onClick={() => setFormData({...formData, budget: b})} className={`p-3 rounded-xl border-2 text-xs font-bold transition-all ${formData.budget === b ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>{b}</button>
                                            ))}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4 pt-4">
                                            <div className="space-y-1.5">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">可開工日期</label>
                                                <input type="date" value={formData.startDate} onChange={e => setFormData({...formData, startDate: e.target.value})} className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none text-xs" />
                                            </div>
                                            <div className="space-y-1.5">
                                                <label className="text-xs font-bold text-stone-400 uppercase tracking-wider">預計完工日</label>
                                                <input type="date" value={formData.endDate} onChange={e => setFormData({...formData, endDate: e.target.value})} className="w-full p-3 rounded-xl border border-stone-100 bg-stone-50 outline-none text-xs" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {step === 6 && (
                                <div className="animate-in space-y-6">
                                    <h2 className="text-2xl font-bold text-stone-800">居住需求詳細</h2>
                                    <div className="space-y-5 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">居住人數</label>
                                            <div className="relative">
                                                <input type="number" value={formData.familyCount} onChange={e => setFormData({...formData, familyCount: e.target.value})} className="w-full p-4 rounded-xl border border-stone-100 bg-stone-50 outline-none pr-12" />
                                                <span className="absolute right-4 top-1/2 -translate-y-1/2 text-stone-300">人</span>
                                            </div>
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">成員組成 (複選)</label>
                                            <div className="grid grid-cols-3 gap-2">
                                                {['小朋友', '長輩', '寵物'].map(m => (
                                                    <button key={m} onClick={() => handleToggle('hasSpecialMember', m)} className={`p-3 rounded-xl border-2 text-xs font-bold ${formData.hasSpecialMember.includes(m) ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>{m}</button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">是否預留變動空間</label>
                                            <div className="grid grid-cols-2 gap-2">
                                                {['不需要', '需要'].map(f => (
                                                    <button key={f} onClick={() => setFormData({...formData, isFutureFlex: f})} className={`p-4 rounded-xl border-2 text-sm font-bold ${formData.isFutureFlex === f ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>{f}</button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-xs font-bold text-stone-400 uppercase tracking-wider ml-1">裝潢目的</label>
                                            <div className="grid grid-cols-2 gap-2">
                                                {['長期自住', '短期自住', '出租', '出售'].map(p => (
                                                    <button key={p} onClick={() => setFormData({...formData, purpose: p})} className={`p-3 rounded-xl border-2 text-xs font-bold ${formData.purpose === p ? 'border-stone-800 bg-stone-50' : 'border-stone-50 bg-white text-stone-400'}`}>{p}</button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {step === 7 && (
                                <div className="animate-in space-y-6">
                                    <h2 className="text-2xl font-bold text-stone-800 text-center">理想空間風格</h2>
                                    <div className="grid grid-cols-2 gap-3 max-h-[350px] overflow-y-auto pr-2 custom-scrollbar">
                                        {STYLES.map(s => (
                                            <div key={s.id} onClick={() => handleToggle('preferredStyles', s.title)} className={`group relative rounded-xl overflow-hidden cursor-pointer border-4 transition-all ${formData.preferredStyles.includes(s.title) ? 'border-stone-800' : 'border-transparent'}`}>
                                                <img src={s.img} alt={s.title} className="w-full h-24 object-cover" />
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end p-2">
                                                    <span className="text-white text-[10px] font-bold tracking-wider">{s.title}</span>
                                                </div>
                                                {formData.preferredStyles.includes(s.title) && <div className="absolute top-1 right-1 bg-stone-800 text-white rounded-full p-1"><Icon name="check" className="w-3 h-3"/></div>}
                                            </div>
                                        ))}
                                    </div>
                                    <textarea value={formData.note} onChange={e => setFormData({...formData, note: e.target.value})} rows="3" placeholder="還有其他想對設計師說的話或需求嗎？" className="w-full p-4 rounded-xl border border-stone-100 bg-stone-50 outline-none text-sm resize-none"></textarea>
                                </div>
                            )}

                            {step === 8 && (
                                <div className="animate-in space-y-8">
                                    <div className="text-center space-y-2">
                                        <h2 className="text-2xl font-bold text-stone-800">如何得知捷士設計？</h2>
                                        <p className="text-stone-400 text-sm">請選擇一個來源，讓我們知道在哪相遇</p>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        {SOURCES.map(s => (
                                            <button 
                                                key={s.id} 
                                                onClick={() => setFormData({...formData, source: s.title})} 
                                                className={`flex flex-col items-center justify-center p-6 rounded-2xl border-2 transition-all gap-3 ${formData.source === s.title ? 'border-stone-800 bg-stone-50 shadow-inner' : 'border-stone-50 bg-white text-stone-400 hover:border-stone-100'}`}
                                            >
                                                <Icon name={s.icon} className={`w-6 h-6 ${formData.source === s.title ? 'text-stone-800' : 'text-stone-300'}`} />
                                                <span className={`text-xs font-bold ${formData.source === s.title ? 'text-stone-800' : 'text-stone-400'}`}>{s.title}</span>
                                            </button>
                                        ))}
                                    </div>
                                    {formData.source === '其他' && (
                                        <div className="animate-in space-y-2">
                                            <label className="text-[10px] font-bold text-stone-400 uppercase tracking-widest ml-1">請說明來源</label>
                                            <input 
                                                type="text" 
                                                value={formData.sourceOther} 
                                                onChange={e => setFormData({...formData, sourceOther: e.target.value})} 
                                                placeholder="例如：報章雜誌、路過門市..." 
                                                className="w-full p-4 rounded-xl border border-stone-100 bg-stone-50 outline-none text-sm"
                                            />
                                        </div>
                                    )}
                                </div>
                            )}

                            {step === 9 && (
                                <div className="text-center space-y-8 animate-in">
                                    <div className="w-20 h-20 bg-stone-50 rounded-full flex items-center justify-center mx-auto">
                                        <Icon name={isSuccess ? "check" : "heart"} className={`w-10 h-10 ${isSuccess ? "text-green-500" : "text-stone-200"}`} />
                                    </div>
                                    <div className="space-y-3">
                                        <h2 className="text-2xl font-bold text-stone-800">{isSuccess ? "送出成功！" : "最後確認"}</h2>
                                        <p className="text-stone-400 text-sm">{isSuccess ? "我們將在 1-3 個工作天內聯繫您。" : "確認以上資訊無誤即可送出"}</p>
                                    </div>
                                    {!isSuccess && (
                                        <div className="p-5 bg-stone-50 rounded-2xl text-left text-[11px] space-y-1.5 border border-stone-100 max-h-[220px] overflow-y-auto custom-scrollbar">
                                            <p className="flex justify-between"><span className="text-stone-400">業主：</span><span className="font-bold">{formData.name}</span></p>
                                            <p className="flex justify-between"><span className="text-stone-400">電話：</span><span className="font-bold">{formData.phone}</span></p>
                                            <p className="flex justify-between"><span className="text-stone-400">LINE ID：</span><span className="font-bold">{formData.lineId}</span></p>
                                            <p className="flex justify-between"><span className="text-stone-400">地點：</span><span className="font-bold">{formData.location === '其他' ? formData.locationOther : formData.location}</span></p>
                                            <p className="flex justify-between"><span className="text-stone-400">坪數：</span><span className="font-bold">{formData.size} 坪</span></p>
                                            <p className="flex justify-between"><span className="text-stone-400">來源：</span><span className="font-bold">{formData.source}</span></p>
                                        </div>
                                    )}
                                    {isSuccess ? (
                                        <button onClick={() => window.location.reload()} className="w-full py-5 bg-stone-900 text-white rounded-2xl font-bold">返回首頁</button>
                                    ) : (
                                        <div className="space-y-3">
                                            <button onClick={handleSubmit} disabled={isSubmitting} className="w-full py-5 bg-stone-900 text-white rounded-2xl font-bold flex items-center justify-center gap-3">
                                                {isSubmitting ? <Icon name="loader" className="w-5 h-5 animate-spin" /> : "確認並送出"}
                                            </button>
                                            <button onClick={prevStep} disabled={isSubmitting} className="w-full py-4 text-stone-400 font-medium text-sm">資訊有誤？返回修改</button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {step > 0 && step < 9 && !isSuccess && (
                            <div className="px-8 pb-10 flex gap-4">
                                <button onClick={prevStep} className="p-5 rounded-2xl bg-stone-50 text-stone-300"><Icon name="chevronLeft" className="w-6 h-6"/></button>
                                <button onClick={nextStep} disabled={(step === 3 && !canGoNextFromDetails) || (step === 8 && !formData.source)} className="flex-1 py-5 bg-stone-900 text-white rounded-2xl font-bold flex items-center justify-center gap-2 disabled:bg-stone-50 disabled:text-stone-200 transition-all">
                                    下一頁 <Icon name="chevronRight" className="w-5 h-5"/>
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
